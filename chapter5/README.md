# 5章 メモリ管理
# Out of Memory
メモリ管理システムはカーネル内の空きメモリが少なくなると、メモリを開放するといったことを行う。しかし、その後もメモリの使用量が増え続けると、システムがメモリ不足により何もできなくなる状態「Out of Momory」となる。この時、適当なプロセスをkillすることによってメモリを開放する「OOM killer」という異能がある。これは何も設定を行っていない時にはどのプロセスがkillされるかは当然わからない。vm.panic_on_oomのパラメータを0から1に変更することでサーバにおいてはOOM発生時にシステムを強制終了させるよう指定することが出来る。

# メモリ割り当て
カーネルがプロセスにメモリを割り当てるときは大きく以下の2つのパターンがある。  
・プロセス生成時→(chapter3)  
・生成済みのプロセスに追加で動的にプロセスを割り当てる時。  

単純なメモリの管理だと以下のような問題が起きてしまう
・メモリが100バイトずつ3箇所のとびとびな場所にある場合でも300バイトの確保は出来ない  
・カーネルや他のプロセスが利用しているメモリ領域にアクセスが可能であるため、システムを破壊しかねない  
・マルチプロセスで扱う際プログラム、データが指定された番地でしか動作できないために並列動作が出来ないことがある。  

このような問題を解決するために仮想記憶が存在する。

# 仮想記憶
直接物理メモリにアクセスした際に起きていた問題が、仮想記憶を用いると問題が消える。単純な仕組みとしては仮想アドレス上の100番地にアクセスしようとすると物理メモリのアドレス600に存在するデータを指定するようにする仕組み。  
ページテーブルという仮想アドレスと物理アドレスを関連付けた表が管理を行っている。しかし、この表に含まれていない領域を指定してしまった時には「ページフォールト」という割り込みが発生する。基本的は「ページフォールトハンドラ」によって不正アクセスかどうかを検知してプロセスへ通知を出し、通知を受けたプロセスは強制終了するようになっている。  
以下のように不正なアクセスを行うとSIGSEGVシグナルが裏で発生して、強制終了する。
```
$ cc -o segv segv.c
$ ./segv 
before invalid access
Segmentation fault (コアダンプ)
```
